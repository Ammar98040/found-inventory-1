<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    {% load static %}
    <link rel="icon" type="image/svg+xml" href="{% static 'img/favicon.svg' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}">

    <style>
        body{background:linear-gradient(135deg,#f8fafc 0%,#eef2ff 100%)}
        .dq-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:18px;border-radius:12px;box-shadow:var(--shadow-lg)}
        .dq-stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin:16px 0}
        .dq-stat{color:#0f172a;border-radius:12px;box-shadow:var(--shadow-lg);padding:16px;font-weight:700}
        .dq-stat.names{background:linear-gradient(135deg,#dbeafe 0%,#93c5fd 100%)}
        .dq-stat.barcodes{background:linear-gradient(135deg,#dcfce7 0%,#86efac 100%)}
        .dq-stat.numbers{background:linear-gradient(135deg,#fae8ff 0%,#f0abfc 100%)}
        .dq-stat.missing{background:linear-gradient(135deg,#fee2e2 0%,#fca5a5 100%)}
        .dq-stat.inconsistent{background:linear-gradient(135deg,#fef3c7 0%,#fde68a 100%)}
        .dq-stat.carton{background:linear-gradient(135deg,#e0e7ff 0%,#c7d2fe 100%)}
        .dq-section{border-radius:12px;box-shadow:var(--shadow-lg);padding:16px;margin-bottom:16px;color:#0f172a}
        .dq-section.names{background:linear-gradient(135deg,#eff6ff 0%,#dbeafe 100%)}
        .dq-section.barcodes{background:linear-gradient(135deg,#f0fdf4 0%,#dcfce7 100%)}
        .dq-section.numbers{background:linear-gradient(135deg,#fdf4ff 0%,#fae8ff 100%)}
        .dq-section.missing{background:linear-gradient(135deg,#fff7ed 0%,#fee2e2 100%)}
        .dq-section.inconsistent{background:linear-gradient(135deg,#fffbeb 0%,#fef3c7 100%)}
        .dq-group{border:1px dashed rgba(15,23,42,0.12);border-radius:10px;padding:12px;margin-bottom:10px;background:rgba(255,255,255,0.5)}
        .dq-items{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px}
        .dq-item{background:#ffffffcc;border-radius:8px;padding:10px}
        .dq-badge{display:inline-block;background:#1e293b;color:#fff;border-radius:999px;padding:4px 10px;font-size:.85rem}
    </style>
</head>
<body>
    <div class="container">
        <div class="dq-header" style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
            <h1 style="margin:0">ğŸ› ï¸ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
            <span class="dq-badge">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª: {{ counts.name|add:counts.barcode|add:counts.number|add:counts.missing_location|add:counts.invalid_carton }}</span>
        </div>

        <div class="dq-stats-grid">
            <div class="dq-stat names">ØªÙƒØ±Ø§Ø± Ø§Ù„Ø£Ø³Ù…Ø§Ø¡<br><span style="font-weight:600;opacity:.8">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: {{ counts.name }}</span></div>
            <div class="dq-stat barcodes">ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯<br><span style="font-weight:600;opacity:.8">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: {{ counts.barcode }}</span></div>
            <div class="dq-stat numbers">ØªÙƒØ±Ø§Ø±/ØªØ´Ø§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬<br><span style="font-weight:600;opacity:.8">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: {{ counts.number }}</span></div>
            <div class="dq-stat missing">Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¯ÙˆÙ† Ù…ÙˆÙ‚Ø¹<br><span style="font-weight:600;opacity:.8">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: {{ counts.missing_location }}</span></div>
        </div>

        {% if duplicates_by_name %}
        <div class="dq-section names">
            <h2 style="margin-bottom:10px;">ØªÙƒØ±Ø§Ø± Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h2>
            {% for group in duplicates_by_name %}
                <div class="dq-group">
                    <div style="font-weight:700; color:#374151; margin-bottom:8px;">{{ group.key }}</div>
                    <div class="dq-items">
                        {% for p in group.items %}
                            <div class="dq-item">
                                <div><strong>Ø±Ù‚Ù…:</strong> {{ p.product_number }}</div>
                                <div><strong>Ø§Ø³Ù…:</strong> {{ p.name }}</div>
                                {% if p.barcode %}<div><strong>Ø¨Ø§Ø±ÙƒÙˆØ¯:</strong> {{ p.barcode }}</div>{% endif %}
                                <div><strong>ÙƒÙ…ÙŠØ©:</strong> {{ p.quantity }}</div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
        {% endif %}

        {% if duplicates_by_barcode %}
        <div class="dq-section barcodes">
            <h2 style="margin-bottom:10px;">ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h2>
            {% for group in duplicates_by_barcode %}
                <div class="dq-group">
                    <div style="font-weight:700; color:#374151; margin-bottom:8px;">{{ group.key }}</div>
                    <div class="dq-items">
                        {% for p in group.items %}
                            <div class="dq-item">
                                <div><strong>Ø±Ù‚Ù…:</strong> {{ p.product_number }}</div>
                                <div><strong>Ø§Ø³Ù…:</strong> {{ p.name }}</div>
                                <div><strong>ÙƒÙ…ÙŠØ©:</strong> {{ p.quantity }}</div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
        {% endif %}

        {% if near_duplicates_by_number %}
        <div class="dq-section numbers">
            <h2 style="margin-bottom:10px;">ØªØ´Ø§Ø¨Ù‡/ØªÙƒØ±Ø§Ø± Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬</h2>
            {% for group in near_duplicates_by_number %}
                <div class="dq-group">
                    <div style="font-weight:700; color:#374151; margin-bottom:8px;">{{ group.key }}</div>
                    <div class="dq-items">
                        {% for p in group.items %}
                            <div class="dq-item">
                                <div><strong>Ø±Ù‚Ù…:</strong> {{ p.product_number }}</div>
                                <div><strong>Ø§Ø³Ù…:</strong> {{ p.name }}</div>
                                <div><strong>ÙƒÙ…ÙŠØ©:</strong> {{ p.quantity }}</div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
        {% endif %}

        {% if counts.missing_location %}
        <div class="dq-section missing">
            <h2 style="margin-bottom:10px;">Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¯ÙˆÙ† Ù…ÙˆÙ‚Ø¹</h2>
            <div class="dq-items">
                {% for p in missing_location_products %}
                    <div class="dq-item">
                        <div><strong>Ø±Ù‚Ù…:</strong> {{ p.product_number }}</div>
                        <div><strong>Ø§Ø³Ù…:</strong> {{ p.name }}</div>
                        <div><strong>ÙƒÙ…ÙŠØ©:</strong> {{ p.quantity }}</div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        


    </div>

    <button id="sidebar-toggle" onclick="toggleSidebar()">â˜°</button>
    <div id="sidebar-overlay"></div>
    <div id="main-sidebar">
        <div class="sidebar-header">
            <h2>ğŸ§­ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…</h2>
            <button class="sidebar-close" onclick="toggleSidebar()">Ã—</button>
        </div>
        <div class="sidebar-search">
            <input type="text" id="sidebar-search-input" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…..." autocomplete="off">
            <div id="sidebar-search-results"></div>
        </div>
        <div class="sidebar-content" id="sidebar-main-content">
            <div class="sidebar-section">
                <div class="sidebar-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                <a href="/" class="sidebar-link">
                    <span class="icon">ğŸ”</span>
                    <span class="text">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                </a>
                <a href="/dashboard/" class="sidebar-link">
                    <span class="icon">ğŸ“Š</span>
                    <span class="text">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                </a>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
                <a href="/audit-logs/" class="sidebar-link">
                    <span class="icon">ğŸ“‹</span>
                    <span class="text">Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</span>
                </a>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Ø§Ù„ØµÙŠØ§Ù†Ø©</div>
                <a href="/backup-restore/" class="sidebar-link">
                    <span class="icon">ğŸ’¾</span>
                    <span class="text">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</span>
                </a>
                <a href="/data-deletion/" class="sidebar-link">
                    <span class="icon">ğŸ—‘ï¸</span>
                    <span class="text">Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                </a>
                <a href="/data-quality/" class="sidebar-link active">
                    <span class="icon">ğŸ› ï¸</span>
                    <span class="text">Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                </a>
            </div>
        </div>
    </div>


    <script src="{% static 'js/sidebar.js' %}"></script>
</body>
</html>