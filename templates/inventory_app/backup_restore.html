<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'css/product_buttons.css' %}">
    <style>
        .backup-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
        }
        .backup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 12px;
            color: white;
            margin-bottom: 30px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-right: 3px solid #667eea;
        }
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        .action-card {
            padding: 25px;
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .action-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }
        .action-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        .upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8fafc;
        }
        .upload-area:hover {
            border-color: var(--primary-color);
            background: #f1f5f9;
        }
        .upload-area.dragover {
            border-color: var(--primary-color);
            background: #eef2ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="backup-header">
            <h1>๐พ ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ</h1>
            <p style="margin: 10px 0 0 0; opacity: 0.9;">ุงุญูุธ ูุงุณุชุนุฏ ุจูุงูุงุชู ุจุฃูุงู ุชุงู</p>
        </div>

        <!-- ุฅุญุตุงุฆูุงุช ุงูุจูุงูุงุช -->
        <div class="backup-section">
            <h2 style="margin-bottom: 20px; color: var(--primary-color);">๐ ุฅุญุตุงุฆูุงุช ุงูุจูุงูุงุช ุงูุญุงููุฉ (ุดุงูู)</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">ุงููุณุชูุฏุนุงุช</div>
                    <div class="stat-value">{{ stats.warehouses }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ุงูุฃูุงูู</div>
                    <div class="stat-value">{{ stats.locations }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ุงูููุชุฌุงุช</div>
                    <div class="stat-value">{{ stats.products }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ุณุฌูุงุช ุงูุนูููุงุช</div>
                    <div class="stat-value">{{ stats.audit_logs }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ุงูุทูุจุงุช</div>
                    <div class="stat-value">{{ stats.orders }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ุงููุฑุชุฌุนุงุช</div>
                    <div class="stat-value">{{ stats.returns }}</div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">ูููุงุช ุงููุณุชุฎุฏููู</div>
                    <div class="stat-value">{{ stats.user_profiles }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ุณุฌูุงุช ุฃูุดุทุฉ ุงููุณุชุฎุฏููู</div>
                    <div class="stat-value">{{ stats.user_activity_logs }}</div>
                </div>
            </div>
        </div>

        <!-- ุชุตุฏูุฑ ุงููุณุฎ ุงูุงุญุชูุงุทู -->
        <div class="backup-section">
            <div class="action-card">
                <div class="action-icon">๐ค</div>
                <h3 style="margin-bottom: 15px;">ุชุตุฏูุฑ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุดุงูู</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    ูู ุจุชูุฒูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ <strong>ุดุงููุฉ ููุงููุฉ</strong> ูู ุฌููุน ุจูุงูุงุช ุงููุธุงูุ ุชุดูู:
                    <br>โข ุฌููุน ุงูููุชุฌุงุช ูุงูุฃูุงูู ูุงููุณุชูุฏุนุงุช
                    <br>โข ุฌููุน ุงูุนูููุงุช (ุฅุถุงูุฉุ ุชุนุฏููุ ุญุฐูุ ุณุญุจุ ุฅุฑุฌุงุน)
                    <br>โข ุฌููุน ุงูุทูุจุงุช ูุงููุฑุชุฌุนุงุช
                    <br>โข ุฌููุน ุณุฌูุงุช ุฃูุดุทุฉ ุงููุณุชุฎุฏููู
                    <br>โข ุฌููุน ูููุงุช ุงููุณุชุฎุฏููู
                    <br><br>ููููู ุงุณุชุฎุฏุงู ูุฐุง ุงูููู ูุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช ุงููุงููุฉ ูุงุญูุงู.
                </p>
                <button onclick="exportBackup()" class="btn btn--sm btn--success">
                    <span class="icon">๐ฅ</span>
                    <span>ุชุญููู ุงููุณุฎ ุงูุงุญุชูุงุทู</span>
                </button>
            </div>
        </div>

        <!-- ุงุณุชูุฑุงุฏ ุงููุณุฎ ุงูุงุญุชูุงุทู -->
        <div class="backup-section">
            <div class="action-card">
                <div class="action-icon">๐ฅ</div>
                <h3 style="margin-bottom: 15px;">ุงุณุชูุฑุงุฏ ุงููุณุฎ ุงูุงุญุชูุงุทู</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    ูู ุจุชุญููู ููู ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช ุงูุณุงุจูุฉ.
                </p>
                
                <div class="upload-area" id="upload-area" onclick="document.getElementById('backup-file-input').click()">
                    <div style="font-size: 3rem; margin-bottom: 15px;">๐</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">ุงููุฑ ูุงุฎุชูุงุฑ ุงูููู ุฃู ุงุณุญุจ ุงูููู ููุง</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">ุงููููุงุช ุงููุฏุนููุฉ: .json</div>
                </div>
                
                <input type="file" id="backup-file-input" accept=".json" style="display: none;" onchange="handleFileSelect(this)">
                
                <div style="margin-top: 20px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="clear-existing" style="width: 18px; height: 18px;">
                        <span>ุญุฐู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูุจู ุงูุงุณุชูุฑุงุฏ</span>
                    </label>
                </div>
                
                <button onclick="importBackup()" class="btn btn--sm btn--success" style="margin-top: 15px;" id="import-btn" disabled>
                    <span class="icon">๐</span>
                    <span>ุงุณุชูุฑุงุฏ ุงููุณุฎ ุงูุงุญุชูุงุทู</span>
                </button>
            </div>
        </div>

        <!-- ูุนูููุงุช ูููุฉ -->
        <div class="backup-section" style="background: #fef3c7; border-right: 4px solid #f59e0b;">
            <h3 style="color: #92400e; margin-bottom: 15px;">โ๏ธ ูุนูููุงุช ูููุฉ</h3>
            <ul style="color: #78350f; line-height: 1.8;">
                <li>ูููุตุญ ุจุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุจุงูุชุธุงู ูุญูุงูุฉ ุจูุงูุงุชู</li>
                <li>ูุญุชูุธ ููู ุงููุณุฎ ุงูุงุญุชูุงุทู ุจุฌููุน ุงูุจูุงูุงุช: ุงููุณุชูุฏุนุงุชุ ุงูุฃูุงููุ ุงูููุชุฌุงุชุ ูุงูุณุฌูุงุช</li>
                <li>ุนูุฏ ุงูุงุณุชูุฑุงุฏ ูุน "ุญุฐู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ"ุ ุณูุชู ูุญู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ</li>
                <li>ุงุญุชูุธ ุจูููุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู ูู ููุงู ุขูู</li>
                <li>ุชุฃูุฏ ูู ุตุญุฉ ููู ุงููุณุฎ ุงูุงุญุชูุงุทู ูุจู ุงูุงุณุชูุฑุงุฏ</li>
            </ul>
        </div>
    </div>

    <!-- Sidebar -->
    <button id="sidebar-toggle" onclick="toggleSidebar()">โฐ</button>
    
    <div id="sidebar-overlay"></div>
    
    <div id="main-sidebar">
        <div class="sidebar-header">
            <h2>๐งญ ุงูููุงุฆู</h2>
            <button class="sidebar-close" onclick="toggleSidebar()">ร</button>
        </div>
        
        <!-- ุญูู ุงูุจุญุซ -->
        <div class="sidebar-search">
            <input type="text" id="sidebar-search-input" placeholder="๐ ุงุจุญุซ ูู ุงูููุงุฆู..." autocomplete="off">
            <div id="sidebar-search-results"></div>
        </div>
        
        <div class="sidebar-content" id="sidebar-main-content">
            <div class="sidebar-section">
                <div class="sidebar-title">ุงูุฑุฆูุณูุฉ</div>
                <a href="/" class="sidebar-link">
                    <span class="icon">๐</span>
                    <span class="text">ุงูุจุญุซ ุนู ุงูููุชุฌุงุช</span>
                </a>
                <a href="/dashboard/" class="sidebar-link">
                    <span class="icon">๐</span>
                    <span class="text">ููุญุฉ ุงูุชุญูู</span>
                </a>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</div>
                <a href="/products/" class="sidebar-link">
                    <span class="icon">๐ฆ</span>
                    <span class="text">ูุงุฆูุฉ ุงูููุชุฌุงุช</span>
                </a>
                <a href="/products/add/" class="sidebar-link">
                    <span class="icon">โ</span>
                    <span class="text">ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</span>
                </a>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">ุงููุณุชูุฏุน</div>
                <a href="/manage/" class="sidebar-link">
                    <span class="icon">โ๏ธ</span>
                    <span class="text">ุฅุฏุงุฑุฉ ุงููุณุชูุฏุน</span>
                </a>
                <a href="/locations/" class="sidebar-link">
                    <span class="icon">๐</span>
                    <span class="text">ุงูุฃูุงูู</span>
                </a>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">ุงูุณุฌูุงุช</div>
                <a href="/audit-logs/" class="sidebar-link">
                    <span class="icon">๐</span>
                    <span class="text">ุณุฌูุงุช ุงูุนูููุงุช</span>
                </a>
            </div>
            
            
            
            <div class="sidebar-section">
                <div class="sidebar-title">ุงูุตูุงูุฉ</div>
                <a href="/backup-restore/" class="sidebar-link active">
                    <span class="icon">๐พ</span>
                    <span class="text">ุงููุณุฎ ุงูุงุญุชูุงุทู</span>
                </a>
                <a href="/data-deletion/" class="sidebar-link">
                    <span class="icon">๐๏ธ</span>
                    <span class="text">ุญุฐู ุงูุจูุงูุงุช</span>
                </a>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">ุงูุฅุญุตุงุฆูุงุช ุงูุญูุฉ</div>
                <div class="stats-container">
                    <div class="stat-category">
                        <div class="stat-category-title">๐ฆ ุงูููุชุฌุงุช</div>
                        <div class="stat-item">
                            <div class="stat-icon">๐ฆ</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stats-products">-</div>
                                <div class="stat-label">ุฅุฌูุงูู</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-category">
                        <div class="stat-category-title">๐ ุงูุฃูุงูู</div>
                        <div class="stat-item">
                            <div class="stat-icon">๐</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stats-capacity">-</div>
                                <div class="stat-label">ุงูุณุนุฉ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'js/sidebar.js' %}"></script>
    <script src="{% static 'js/auto_refresh.js' %}"></script>
    
    <script>
        let selectedFile = null;

        function exportBackup() {
            if (!confirm('ูู ุชุฑูุฏ ุชุญููู ุงููุณุฎ ุงูุงุญุชูุงุทูุ')) {
                return;
            }
            
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/api/export-backup/';
            
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
            if (!csrfToken) {
                const token = document.createElement('input');
                token.type = 'hidden';
                token.name = 'csrfmiddlewaretoken';
                token.value = '{{ csrf_token }}';
                form.appendChild(token);
            }
            
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
        }

        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                selectedFile = input.files[0];
                
                // ุนุฑุถ ุงุณู ุงูููู
                const uploadArea = document.getElementById('upload-area');
                uploadArea.innerHTML = `
                    <div style="font-size: 2rem; margin-bottom: 10px;">โ</div>
                    <div style="font-weight: bold; color: #10b981;">${selectedFile.name}</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">${(selectedFile.size / 1024).toFixed(2)} KB</div>
                    <button onclick="event.stopPropagation(); document.getElementById('backup-file-input').click();" class="btn btn--xs btn--neutral" style="margin-top: 10px;">
                        <span>ุชุบููุฑ ุงูููู</span>
                    </button>
                `;
                
                document.getElementById('import-btn').disabled = false;
            }
        }

        function importBackup() {
            if (!selectedFile) {
                alert('ูุฑุฌู ุงุฎุชูุงุฑ ููู ุงููุณุฎ ุงูุงุญุชูุงุทู');
                return;
            }
            
            const clearExisting = document.getElementById('clear-existing').checked;
            
            let message = 'ูู ุชุฑูุฏ ุงุณุชูุฑุงุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุ';
            if (clearExisting) {
                message = 'โ๏ธ ุณูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ!\n' + message;
            }
            
            if (!confirm(message)) {
                return;
            }
            
            const formData = new FormData();
            formData.append('backup_file', selectedFile);
            formData.append('clear_existing', clearExisting);
            
            // ุฅุถุงูุฉ CSRF token
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
            if (csrfToken) {
                formData.append('csrfmiddlewaretoken', csrfToken.value);
            } else {
                // ูุญุงููุฉ ุงูุญุตูู ูู cookies
                const cookieValue = document.cookie
                    .split('; ')
                    .find(row => row.startsWith('csrftoken='))
                    ?.split('=')[1];
                if (cookieValue) {
                    formData.append('csrfmiddlewaretoken', cookieValue);
                }
            }
            
            fetch('/api/import-backup/', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('โ ' + data.message);
                    window.location.reload();
                } else {
                    alert('โ ' + data.error);
                }
            })
            .catch(error => {
                alert('โ ุญุฏุซ ุฎุทุฃ: ' + error.message);
            });
        }

        // Drag and drop functionality
        const uploadArea = document.getElementById('upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('backup-file-input').files = files;
                handleFileSelect(document.getElementById('backup-file-input'));
            }
        });
    </script>
</body>
</html>
