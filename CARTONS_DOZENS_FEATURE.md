# 📦 نظام حساب الكراتين والدرازن

## ✨ **الميزة الجديدة:**

تم إضافة نظام متكامل لحساب الكراتين والدرازن تلقائياً في قائمة المنتجات.

---

## 🎯 **الأعمدة الجديدة:**

### **1️⃣ درزن/كرتون** (قابل للتعديل)
- ✅ حقل إدخال يدوي
- ✅ يحدد كم درزن في الكرتون الواحد
- ✅ مثال: 5 درزن/كرتون

### **2️⃣ عدد الدرازن** (محسوب تلقائياً)
- ✅ يُحسب من الكمية الإجمالية
- ✅ الحساب: `الكمية ÷ 12`
- ✅ لون أزرق مميز

### **3️⃣ عدد الكراتين** (محسوب تلقائياً)
- ✅ يُحسب من عدد الدرازن
- ✅ الحساب: `عدد الدرازن ÷ درزن/كرتون`
- ✅ لون بنفسجي مميز

---

## 📊 **مثال عملي:**

### **السيناريو:**
- **الكمية الإجمالية:** 200 حبة
- **درزن/كرتون:** 5 درزن
- **الدرزن:** 12 حبة

### **الحساب:**
```
1. عدد الدرازن = 200 ÷ 12 = 16.67 درزن
2. عدد الكراتين = 16.67 ÷ 5 = 3.33 كرتون
```

### **النتيجة في الجدول:**
```
┌────────┬─────────┬──────────┬─────────┬──────────┬──────────┐
│ المنتج │ الكمية  │ درزن/كرتون│ الدرازن │ الكراتين │ الإجراءات│
├────────┼─────────┼──────────┼─────────┼──────────┼──────────┤
│ 55     │ 200    │ [5]      │ 16.67   │ 3.33     │ ...      │
└────────┴─────────┴──────────┴─────────┴──────────┴──────────┘
```

---

## 🔧 **كيف يعمل؟**

### **1️⃣ تغيير درزن/كرتون:**
1. انتقل إلى قائمة المنتجات
2. غيّر القيمة في عمود "درزن/كرتون"
3. سيتم الحفظ تلقائياً
4. ستُحدث الصفحة لإظهار الحسابات الجديدة

### **2️⃣ الحساب التلقائي:**
- عند تغيير الكمية (إضافة/سحب)
- يُحسب عدد الدرازن تلقائياً
- يُحسب عدد الكراتين تلقائياً

### **3️⃣ السحب من المخزون:**
- عند سحب كمية (مثلاً 60 حبة)
- الكمية الجديدة: 200 - 60 = 140
- عدد الدرازن الجديد: 140 ÷ 12 = 11.67
- عدد الكراتين الجديد: 11.67 ÷ 5 = 2.33

---

## 🎨 **التصميم:**

### **الألوان:**
- **الكمية:** أخضر (#059669)
- **عدد الدرازن:** أزرق (#3b82f6)
- **عدد الكراتين:** بنفسجي (#8b5cf6)

### **حقل الإدخال:**
- عرض: 60px
- حدود رمادية فاتحة
- زوايا دائرية
- يتغير عند التعديل

---

## 🔢 **الصيغ الرياضية:**

### **عدد الدرازن:**
```python
total_dozens = quantity / pcs_per_dozen
# مثال: 200 / 12 = 16.67
```

### **عدد الكراتين:**
```python
total_cartons = total_dozens / dozens_per_carton
# مثال: 16.67 / 5 = 3.33
```

---

## 📱 **العرض على الهواتف:**

### **الأعمدة المعروضة:**
- ✅ رقم المنتج
- ✅ الصورة
- ✅ الكمية
- ✅ الإجراءات

### **الأعمدة المخفية:**
- ❌ الاسم
- ❌ الفئة
- ❌ درزن/كرتون
- ❌ عدد الدرازن
- ❌ عدد الكراتين
- ❌ الأماكن

---

## 🔄 **التحديث التلقائي:**

### **متى يُحدث؟**
1. ✅ عند سحب كمية من المخزون
2. ✅ عند إضافة كمية (مرتجعات)
3. ✅ عند تعديل الكمية يدوياً
4. ✅ عند تغيير درزن/كرتون

### **كيف يُحدث؟**
- الحساب يتم في الـ Backend (Python)
- دوال مخصصة في النموذج:
  - `get_total_dozens()`
  - `get_total_cartons()`

---

## 🛠️ **التفاصيل التقنية:**

### **1️⃣ النموذج (models.py):**
```python
class Product(models.Model):
    quantity = models.IntegerField()  # الكمية الإجمالية
    dozens_per_carton = models.IntegerField(default=1)  # درزن/كرتون
    pcs_per_dozen = models.IntegerField(default=12)  # حبة/درزن
    
    def get_total_dozens(self):
        """حساب عدد الدرازن"""
        return self.quantity / self.pcs_per_dozen
    
    def get_total_cartons(self):
        """حساب عدد الكراتين"""
        total_dozens = self.get_total_dozens()
        return total_dozens / self.dozens_per_carton
```

### **2️⃣ القالب (products_list.html):**
```django
<td>{{ product.get_total_dozens|floatformat:2 }}</td>
<td>{{ product.get_total_cartons|floatformat:2 }}</td>
```

### **3️⃣ API Endpoint:**
```
POST /api/products/{id}/update-dozens-per-carton/
Body: { "dozens_per_carton": 5 }
```

---

## ✅ **الفوائد:**

1. ✅ **حساب تلقائي دقيق**
2. ✅ **لا حاجة للحساب اليدوي**
3. ✅ **تحديث فوري عند السحب**
4. ✅ **مرونة في تغيير درزن/كرتون**
5. ✅ **عرض واضح وملون**

---

## 🧪 **اختبار الميزة:**

### **الخطوة 1: عرض البيانات**
1. افتح: `http://127.0.0.1:8000/products/`
2. شاهد الأعمدة الجديدة
3. لاحظ الألوان المميزة

### **الخطوة 2: تغيير درزن/كرتون**
1. غيّر القيمة في عمود "درزن/كرتون"
2. انتظر التحديث
3. شاهد الحسابات الجديدة

### **الخطوة 3: اختبار السحب**
1. اذهب إلى الصفحة الرئيسية
2. ابحث عن منتج وحدد كمية
3. أكد السحب
4. ارجع لقائمة المنتجات
5. شاهد الكميات والحسابات المحدثة

---

## 📊 **أمثلة إضافية:**

### **مثال 1: كمية صغيرة**
```
الكمية: 36 حبة
درزن/كرتون: 3
عدد الدرازن: 36 ÷ 12 = 3.00
عدد الكراتين: 3 ÷ 3 = 1.00
```

### **مثال 2: كمية كبيرة**
```
الكمية: 1440 حبة
درزن/كرتون: 10
عدد الدرازن: 1440 ÷ 12 = 120.00
عدد الكراتين: 120 ÷ 10 = 12.00
```

### **مثال 3: كمية غير كاملة**
```
الكمية: 150 حبة
درزن/كرتون: 4
عدد الدرازن: 150 ÷ 12 = 12.50
عدد الكراتين: 12.5 ÷ 4 = 3.13
```

---

## 📄 **الملفات المعدلة:**

1. ✅ `inventory_app/models.py` - دوال الحساب
2. ✅ `inventory_app/views.py` - API endpoint
3. ✅ `inventory_app/urls.py` - مسار API
4. ✅ `templates/inventory_app/products_list.html` - UI
5. ✅ `inventory_app/templatetags/custom_filters.py` - فلاتر مخصصة

---

## 🎯 **النتيجة النهائية:**

- ✅ **حساب دقيق وتلقائي**
- ✅ **واجهة واضحة وملونة**
- ✅ **تحديث فوري عند السحب**
- ✅ **مرونة كاملة في التعديل**
- ✅ **عرض متجاوب على الهواتف**

---

**تم التطبيق بتاريخ:** 2025-11-09  
**الحالة:** ✅ نشط ويعمل  
**التقييم:** ⭐⭐⭐⭐⭐ (5/5)

