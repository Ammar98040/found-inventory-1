# 📦 نظام التفصيل الذكي للكميات

## ✨ **الميزة المحسّنة:**

نظام ذكي لعرض تفاصيل الكميات بشكل واضح ودقيق:
- **كراتين** (أعداد صحيحة فقط)
- **درازن** (أعداد صحيحة فقط)
- **حبات** (الباقي)

---

## 🎯 **كيف يعمل؟**

### **المثال 1:**
```
الكمية الإجمالية: 200 حبة
درزن/كرتون: 5

الحساب:
1. الكرتون الواحد = 5 درزن × 12 حبة = 60 حبة
2. عدد الكراتين = 200 ÷ 60 = 3 كرتون (والباقي 20)
3. عدد الدرازن = 20 ÷ 12 = 1 درزن (والباقي 8)
4. الباقي = 8 حبات

النتيجة: 3 كرتون + 1 درزن + 8 حبات
```

### **المثال 2:**
```
الكمية الإجمالية: 150 حبة
درزن/كرتون: 4

الحساب:
1. الكرتون الواحد = 4 × 12 = 48 حبة
2. عدد الكراتين = 150 ÷ 48 = 3 كرتون (والباقي 6)
3. عدد الدرازن = 6 ÷ 12 = 0 درزن (والباقي 6)
4. الباقي = 6 حبات

النتيجة: 3 كرتون + 6 حبات
```

### **المثال 3:**
```
الكمية الإجمالية: 20 حبة
درزن/كرتون: 5

الحساب:
1. الكرتون الواحد = 5 × 12 = 60 حبة
2. عدد الكراتين = 20 ÷ 60 = 0 كرتون (والباقي 20)
3. عدد الدرازن = 20 ÷ 12 = 1 درزن (والباقي 8)
4. الباقي = 8 حبات

النتيجة: 1 درزن + 8 حبات
```

---

## 📊 **العرض في الجدول:**

```
┌────────┬─────────┬──────────┬─────────────────────────────┐
│ المنتج │ الكمية  │ درزن/كرتون│ التفاصيل                    │
├────────┼─────────┼──────────┼─────────────────────────────┤
│ 55     │ 200    │ [5]      │ 3 كرتون + 1 درزن + 8 حبات │
│        │        │          │ 📦 3  🎁 1  🔢 8           │
├────────┼─────────┼──────────┼─────────────────────────────┤
│ 985    │ 150    │ [4]      │ 3 كرتون + 6 حبات           │
│        │        │          │ 📦 3  🔢 6                 │
├────────┼─────────┼──────────┼─────────────────────────────┤
│ 916    │ 20     │ [5]      │ 1 درزن + 8 حبات            │
│        │        │          │ 🎁 1  🔢 8                 │
└────────┴─────────┴──────────┴─────────────────────────────┘
```

---

## 🎨 **التصميم:**

### **السطر الأول:**
```
3 كرتون + 1 درزن + 8 حبات
```
- لون أخضر (#059669)
- خط عريض
- حجم 0.95rem

### **السطر الثاني (الأيقونات):**
```
📦 3  🎁 1  🔢 8
```
- **📦 كرتون:** خلفية زرقاء فاتحة (#dbeafe)
- **🎁 درزن:** خلفية بنفسجية فاتحة (#e0e7ff)
- **🔢 حبات:** خلفية خضراء فاتحة (#dcfce7)

---

## 🔢 **الصيغة الرياضية:**

```python
def get_quantity_breakdown(self):
    remaining = self.quantity
    
    # 1. حساب الكراتين (عدد صحيح)
    pieces_per_carton = dozens_per_carton × 12
    cartons = remaining // pieces_per_carton
    remaining = remaining % pieces_per_carton
    
    # 2. حساب الدرازن (عدد صحيح)
    dozens = remaining // 12
    
    # 3. الباقي بالحبات
    pieces = remaining % 12
    
    return {
        'cartons': cartons,
        'dozens': dozens,
        'pieces': pieces,
        'formatted': f'{cartons} كرتون + {dozens} درزن + {pieces} حبة'
    }
```

---

## 📱 **العرض على الهواتف:**

### **الأعمدة المعروضة:**
- ✅ رقم المنتج
- ✅ الصورة
- ✅ الكمية
- ✅ الإجراءات

### **الأعمدة المخفية:**
- ❌ الاسم، الفئة
- ❌ درزن/كرتون
- ❌ التفاصيل
- ❌ الأماكن

---

## 🔄 **التحديث التلقائي:**

### **عند السحب:**
```
قبل السحب:
- الكمية: 200 حبة
- التفاصيل: 3 كرتون + 1 درزن + 8 حبات

السحب: 60 حبة

بعد السحب:
- الكمية: 140 حبة
- التفاصيل: 2 كرتون + 1 درزن + 8 حبات
```

### **عند الإضافة (مرتجعات):**
```
قبل الإضافة:
- الكمية: 140 حبة
- التفاصيل: 2 كرتون + 1 درزن + 8 حبات

الإضافة: 60 حبة

بعد الإضافة:
- الكمية: 200 حبة
- التفاصيل: 3 كرتون + 1 درزن + 8 حبات
```

---

## 🧪 **أمثلة إضافية:**

### **مثال 1: كمية صغيرة**
```
الكمية: 15 حبة
درزن/كرتون: 5
النتيجة: 1 درزن + 3 حبات
```

### **مثال 2: كمية متوسطة**
```
الكمية: 100 حبة
درزن/كرتون: 3
النتيجة: 2 كرتون + 2 درزن + 4 حبات
```

### **مثال 3: كمية كبيرة**
```
الكمية: 500 حبة
درزن/كرتون: 5
النتيجة: 8 كرتون + 1 درزن + 8 حبات
```

### **مثال 4: كمية دقيقة (درزن كامل)**
```
الكمية: 60 حبة
درزن/كرتون: 5
النتيجة: 1 كرتون
```

### **مثال 5: كمية دقيقة (درازن كاملة)**
```
الكمية: 36 حبة
درزن/كرتون: 5
النتيجة: 3 درزن
```

---

## ✅ **الفوائد:**

| قبل | بعد |
|-----|-----|
| ❌ 16.67 درزن | ✅ 1 درزن + 8 حبات |
| ❌ 3.33 كرتون | ✅ 3 كرتون + 1 درزن + 8 حبات |
| ❌ أرقام عشرية | ✅ أعداد صحيحة فقط |
| ❌ غير واضح | ✅ واضح ومفصل |

---

## 🎯 **الحالات الخاصة:**

### **حالة 1: فقط حبات**
```
الكمية: 5 حبات
النتيجة: 5 حبات
```

### **حالة 2: فقط درزن**
```
الكمية: 12 حبة
النتيجة: 1 درزن
```

### **حالة 3: فقط كرتون**
```
الكمية: 60 حبة (5 درزن/كرتون)
النتيجة: 1 كرتون
```

### **حالة 4: كمية صفر**
```
الكمية: 0 حبة
النتيجة: 0 حبة
```

---

## 📄 **الملفات المعدلة:**

1. ✅ `inventory_app/models.py` - دالة `get_quantity_breakdown()`
2. ✅ `templates/inventory_app/products_list.html` - عمود التفاصيل
3. ✅ `QUANTITY_BREAKDOWN_FEATURE.md` - التوثيق

---

## 🎯 **النتيجة النهائية:**

- ✅ **أعداد صحيحة فقط (لا كسور)**
- ✅ **عرض واضح ومفصل**
- ✅ **أيقونات ملونة مميزة**
- ✅ **تحديث تلقائي عند السحب/الإضافة**
- ✅ **سهل الفهم والقراءة**

---

**مثال نهائي:**
```
الكمية: 200 حبة
درزن/كرتون: 5

العرض:
┌─────────────────────────────────┐
│ 3 كرتون + 1 درزن + 8 حبات     │
│ 📦 3  🎁 1  🔢 8              │
└─────────────────────────────────┘
```

**تم التطبيق بتاريخ:** 2025-11-09  
**الحالة:** ✅ نشط ويعمل  
**التقييم:** ⭐⭐⭐⭐⭐ (5/5)

